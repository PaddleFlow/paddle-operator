apiVersion: batch.paddlepaddle.org/v1
kind: PaddleJob
metadata:
  name: ps-deepfm
spec:
  cleanPodPolicy: OnFailed
  withGloo: 1
  mode: PS
  tasks:
  #- name: driver
  #  replicas: 1
  #  template:
  #    spec:
  #      containers:
  #        - name: paddle
  #          image: registry.baidubce.com/paddle-operator/demo-deepfm:v1
  #          imagePullPolicy: Always
  #          command:
  #          - sleep
  #          args:
  #          - "3600"
  - name: ps-1
    replicas: 1
    template:
      spec:
        containers:
          - name: paddle
            image: registry.baidubce.com/paddle-operator/demo-deepfm:v1
            imagePullPolicy: Always
            command:
            - python3
            args:
            - train.py
  - name: ps-2
    replicas: 1
    template:
      spec:
        containers:
          - name: paddle
            image: registry.baidubce.com/paddle-operator/demo-deepfm:v1
            imagePullPolicy: Always
            command:
            - python3
            args:
            - train.py
  - name: trainer
    replicas: 2
    template:
      spec:
        containers:
          - name: paddle
            image: registry.baidubce.com/paddle-operator/demo-deepfm:v1
            imagePullPolicy: Always
            command:
            - python3
            args:
            - train.py
